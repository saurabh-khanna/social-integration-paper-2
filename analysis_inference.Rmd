---
title: "Analysis for SN Paper 2"
author: "Saurabh Khanna"
date: "`r Sys.Date()`"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
# Libraries
library(tidyverse)
library(haven)
library(stargazer)
library(plm)
library(sandwich)
library(lmtest)
library(AER)

# Parameters
data_file <- here::here("data/stu_admin_all_with_netvars.Rds")
```


Read main data file:

```{r}
df <-
  data_file %>%
  read_rds()
```


Reservation students:

```{r}
df %>%
  filter(stu_merge == 3) %>% 
  mutate(
    age = 2017 - lubridate::year(b_birthdate)
  ) %>% 
  filter(reservation == "Reservation") %>%
  # lm(
  #   e_seg_studymate ~ 
  #     ea_seats_reserved_students_sc + ea_seats_reserved_students_st + ea_seats_reserved_students_obc,
  #   data = .
  # ) %>% 
  ivreg(
    e_ql_score_perc ~ e_seg_studymate + b_ql_score_perc + gender + age |
    ea_seats_reserved_students_sc + ea_seats_reserved_students_st + ea_seats_reserved_students_obc + b_ql_score_perc + gender + age,
    data = .
  ) %>%
  coeftest(vcov = vcovHC, type = "HC1")
```

